docker.enabled    = true
docker.runOptions = '-u $(id -u):$(id -g)'

// Global default params, used in configs
params {
    input = false
    atlas = false
    output = 'output'
    run_denoising = true
    run_eddy = false
    run_n4 = true
}


process {
    withName: "DENOISING_MPPCA" {
        ext.extent = 3
    }
    withName: "PREPROC_SINGLEEDDY" {
        ext.eddy_cmd = "eddy_cpu"
        ext.encoding = "y"
        ext.readout = 0.01536
        ext.extra_args = ""
    }
    withName: "MOUSE_BETDWI" {
        ext.threshold = 0.3
        ext.dwi_shell_tolerance = 20
        ext.min_fodf_shell_value = 500
    }

    withName: "MOUSE_N4" {
        ext.threshold=0.001
        ext.convergence = "150x150x150x150"
    }

    withName: "RESAMPLE_DWI" {
        ext.iso_min = true
        ext.interp = "lin"
    }

    withName: "RESAMPLE_MASK" {
        ext.iso_min = true
        ext.interp = "nn"
        ext.first_suffix = "mask"
    }

    withName: "MOUSE_REGISTRATION" {
        ext.laplacian_value = "0.1mm"
        ext.atlas_50_resolution = "50"
        ext.atlas_100_resolution = "100"
        ext.atlas_resolution = ""
    }

    withName: "IMAGE_CONVERT" {
        ext.datatype = "uint8"
        ext.first_suffix = "mask"
    }

    withName: "RECONST_DTIMETRICS" {
        ext.ad = true
        ext.evecs = true
        ext.evals = true
        ext.fa = true
        ext.ga = true
        ext.rgb = true
        ext.md = true
        ext.mode = true
        ext.norm = true
        ext.rd = true
        ext.tensor = true
        ext.nonphysical = true
        ext.pulsation = true
        ext.residual = true
        ext.b0_thr_extract_b0 = 10
        ext.dwi_shell_tolerance = 50
        ext.max_dti_shell_value = 3500
    }

    withName: "RECONST_FRF" {
        ext.nvox_min = 50
        ext.max_dti_shell_value = 3500
    }

    withName: "TRACKING_MASK" {
        ext.ventricules_labels_ids="82 401 748 800 961 962 963 1092 1107 1132 1145 1146"
        ext.seeding_labels_ids="1138 1139 1140 1141 1142 1173 1174 1179 1182 1205"
    }

    withName: "TRACKING_LOCALTRACKING" {
        ext.rk_order = 4
        ext.local_compress_streamlines=false
        ext.run_local_tracking=true
        ext.local_algo="prob"
        ext.local_seeding="npv"
        ext.local_nbr_seeds=1
        ext.local_step=0.05
        ext.local_theta=20
        ext.local_rk_order=2
        ext.local_sfthres=0.1
        ext.local_sfthres_init=0.5
        ext.local_min_len=3
        ext.local_max_len=15
        ext.local_compress_value=0.2
        ext.local_tracking_mask_type="wm"
        ext.local_seeding_mask_type="fa"
        ext.local_fa_seeding_mask_threshold="0"
        ext.local_fa_tracking_mask_threshold="0"
        ext.cmd="scil_tracking_local_dev.py"
    }

    withName: "MOUSE_EXTRACTMASKS" {
        ext.labels = "FRP MO SS GU VISC AUD VIS ACA PL ILA ORB AI RSP PTLp Tea PERI ECT MOB AOB AON TT DP PIR NLOT COA TR CA DG IG ENT PAR POST PRE SUB ProS HATA APr CLA EP LA BLA BMA PA CP ACB FS OT LSS LSX sAMY PAL TH HY MB P MY CBX CBN fiber_tracts"
    }
}